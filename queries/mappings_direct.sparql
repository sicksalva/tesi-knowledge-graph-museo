PREFIX fx: <http://sparql.xyz/facade-x/ns/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX ex: <http://example.org/>
PREFIX schema: <http://schema.org/>

CONSTRUCT {
  ?vehicle a schema:Vehicle ;
           ex:inventario ?inventario ;
           schema:brand ?marca ;
           schema:model ?modello ;
           schema:modelDate ?anno ;
           ex:productionYears ?anniProduzione ;
           schema:countryOfOrigin ?paese ;
           schema:purchaseDate ?acquisizione ;
           ex:engineType ?tipoMotore ;
           ex:displacement ?cilindrata ;
           schema:power ?potenza ;
           schema:speed ?velocita ;
           schema:bodyType ?carrozzeria .
}
WHERE {
  SERVICE <x-sparql-anything:location=data/museo.csv> {
    ?row rdf:_1 ?inventario ;
         rdf:_2 ?marca ;
         rdf:_3 ?modello ;
         rdf:_4 ?anno ;
         rdf:_6 ?paese .
    
    # Creo URI veicolo basato su Inventario
    BIND(IRI(CONCAT("http://example.org/vehicle/", ENCODE_FOR_URI(?inventario))) AS ?vehicle)
    
    # Filtro solo le righe con dati validi (esclude header e righe vuote)
    FILTER(?inventario != "" && ?inventario != "N. inventario" && ?inventario != "VETTURA")
    
    # Propriet√† opzionali - aggiunte solo se hanno valore
    OPTIONAL {
      ?row rdf:_5 ?anniProduzioneRaw .
      FILTER(?anniProduzioneRaw != "" && BOUND(?anniProduzioneRaw))
      BIND(?anniProduzioneRaw AS ?anniProduzione)
    }
    
    OPTIONAL {
      ?row rdf:_10 ?acquisizioneRaw .
      FILTER(?acquisizioneRaw != "" && BOUND(?acquisizioneRaw))
      BIND(?acquisizioneRaw AS ?acquisizione)
    }
    
    OPTIONAL {
      ?row rdf:_12 ?tipoMotoreRaw .
      FILTER(?tipoMotoreRaw != "" && BOUND(?tipoMotoreRaw))
      BIND(?tipoMotoreRaw AS ?tipoMotore)
    }
    
    OPTIONAL {
      ?row rdf:_15 ?cilindrataRaw .
      FILTER(?cilindrataRaw != "" && BOUND(?cilindrataRaw))
      BIND(?cilindrataRaw AS ?cilindrata)
    }
    
    OPTIONAL {
      ?row rdf:_16 ?potenzaRaw .
      FILTER(?potenzaRaw != "" && BOUND(?potenzaRaw))
      BIND(?potenzaRaw AS ?potenza)
    }
    
    OPTIONAL {
      ?row rdf:_21 ?velocitaRaw .
      FILTER(?velocitaRaw != "" && BOUND(?velocitaRaw))
      BIND(?velocitaRaw AS ?velocita)
    }
    
    OPTIONAL {
      ?row rdf:_25 ?carrozzeriaRaw .        # Colonna 25: Carrozzeria
      FILTER(?carrozzeriaRaw != "" && BOUND(?carrozzeriaRaw))
      BIND(?carrozzeriaRaw AS ?carrozzeria)
    }
  }
}